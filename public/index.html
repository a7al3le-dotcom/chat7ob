<!DOCTYPE html>
<html lang="ar" hreflang="ar-sa" style="height: 100%;">
<head>   
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="HandheldFriendly" content="True">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <title>شات جوال هوست | شات الجوال | دردشة جوال هوست | شات للجوال | استضافة شات</title>
  
  <meta name="description" content="شات جوال هوست للجوال,دردشة,شات الجوال,دردشة جوال هوست,دردشة الجوال,شات الجوال للجوال,استضافه جوال هوست الكتابي,شات هوست،شات فون هوست,استضافة شات,فتح شات,هوست شات,استضافة جوال,استضافة فون هوست للجوال,استضافة دردشة فون هوست,شات الرياض الصوتي للجوال,استضافة شات,فتح شات,شات جوال الخليج,شات موبايل هوست.دردشة موبايل هوست .شات جوال جوال للجوال , دردشة شات للجوال الكتابية الصوتية للجوال,شات جوال للجوال,دردشة الرياض للجوال الكتابي,شات جوال الرياض الصوتي,دردشة الرياض الصوتي للجوال,شات الرياض الصوتي,دردشة الرياض الصوتية,شات الرياض,دردشة الرياض,شات الرياض.للجوال,شات.دردشة.الرياض.الصوتي,شات دردشة الرياض الكتابي الصوتي للجوال,شات عشق,دردشة,عشق,شات عشق الخليج,شات الرياض,دردشة كتابي,شات الجوال,شات الرياض, شات طيفك للجوال,تايجر هوست,دردشة طيفك,شات طيفك الصوتي">
  
  <style>
    /* الأساسيات */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      font-family: Tahoma, Geneva, sans-serif;
      background-color: #40404f;
      color: #333;
    }
    
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }
    
    /* الحاوية الرئيسية */
    .main-wrapper {
      width: 100%;
      max-width: 400px;
      height: 100%;
      max-height: 700px;
      background-color: white;
      border-radius: 5px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }
    
    /* الهيدر الأصلي */
    .header {
      background-color: #2F5C73;
      color: white;
      padding: 8px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #1a4557;
    }
    
    .header-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .header-title {
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      flex-grow: 1;
    }
    
    /* البنر تحت الهيدر */
    .banner {
      text-align: center;
      padding: 8px 5px;
      background: linear-gradient(45deg, #4a5f6e, #5a6f7e);
      color: white;
      font-weight: bold;
      font-size: 14px;
      border-bottom: 2px solid #3a4f5e;
    }
    
    /* تبويبات الدخول */
    .tabs {
      display: flex;
      background-color: white;
      border-bottom: 1px solid #ddd;
    }
    
    .tab {
      flex: 1;
      text-align: center;
      padding: 10px 5px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-size: 14px;
    }
    
    .tab.active {
      border-bottom: 2px solid #2F5C73;
      color: #2F5C73;
      font-weight: bold;
    }
    
    /* نماذج الدخول */
    .login-forms {
      padding: 10px;
      background-color: #f5f5f5;
    }
    
    .login-form {
      display: none;
    }
    
    .login-form.active {
      display: block;
    }
    
    .form-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 3px;
      font-size: 14px;
      margin-bottom: 10px;
    }
    
    .form-btn {
      background-color: #2F5C73;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
    }
    
    /* شريط الحالة */
    .status-bar {
      background-color: #2F5C73;
      color: white;
      padding: 5px 10px;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
    }
    
    /* منطقة المتواجدين */
    .online-users {
      background-color: #fafafa;
      padding: 10px;
      height: 150px;
      overflow-y: auto;
      border-bottom: 1px solid #eee;
    }
    
    .user-item {
      padding: 5px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    
    .user-item:hover {
      background-color: #f0f0f0;
    }
    
    .no-users {
      text-align: center;
      color: #888;
      font-style: italic;
      padding: 20px 0;
    }
    
    /* منطقة المحادثة */
    .chat-area {
      display: none;
      flex-direction: column;
      height: 100%;
    }
    
    .messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      background-color: #f9f9f9;
    }
    
    /* تصميم جديد للرسائل */
    .message {
      margin-bottom: 15px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      position: relative;
    }
    
    .system-message {
      text-align: center;
      margin: 10px 0;
    }
    
    .system-message .message-content {
      background-color: #e9ecef;
      border-color: #dee2e6;
    }
    
    .system-message .message-text {
      color: #6c757d;
      font-style: italic;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 5px;
      background-color: #2F5C73;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 16px;
      flex-shrink: 0;
      cursor: pointer;
      background-size: cover;
      background-position: center;
    }
    
    .admin-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #dc3545;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .message-content {
      flex: 1;
      background-color: white;
      border-radius: 8px;
      padding: 10px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .message-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }
    
    .message-sender {
      font-weight: bold;
      color: #2F5C73;
      font-size: 14px;
      cursor: pointer;
    }
    
    .admin-sender {
      color: #dc3545;
    }
    
    .message-time {
      font-size: 11px;
      color: #888;
    }
    
    .message-text {
      font-size: 14px;
      line-height: 1.4;
    }
    
    .delete-message-btn {
      position: absolute;
      top: 5px;
      left: 5px;
      background: rgba(220, 53, 69, 0.8);
      color: white;
      border: none;
      border-radius: 3px;
      width: 20px;
      height: 20px;
      font-size: 10px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
    }
    
    .message-content:hover .delete-message-btn {
      display: flex;
    }
    
    /* منطقة المايكروفونات */
    .microphones-panel {
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      padding: 10px;
    }
    
    .microphones-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .microphones-title {
      font-size: 14px;
      font-weight: bold;
      color: #2F5C73;
    }
    
    .mute-all-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 12px;
      cursor: pointer;
    }
    
    .microphones-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
    }
    
    .microphone-slot {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 8px 5px;
      text-align: center;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .microphone-slot.active {
      border-color: #28a745;
      background: #f8fff9;
    }
    
    .microphone-slot.muted {
      border-color: #6c757d;
      background: #f8f9fa;
    }
    
    .microphone-user {
      font-size: 10px;
      font-weight: bold;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .microphone-controls {
      display: flex;
      justify-content: center;
      gap: 3px;
    }
    
    .mic-btn {
      width: 20px;
      height: 20px;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 8px;
    }
    
    .mic-toggle {
      background: #28a745;
      color: white;
    }
    
    .mic-mute {
      background: #ffc107;
      color: black;
    }
    
    .mic-kick {
      background: #dc3545;
      color: white;
      display: none;
    }
    
    .microphone-slot:hover .mic-kick {
      display: flex;
    }
    
    .mic-status {
      font-size: 8px;
      margin-top: 3px;
      color: #6c757d;
    }
    
    .mic-talking {
      color: #28a745;
      font-weight: bold;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    /* منطقة إدخال الرسالة */
    .input-area {
      display: flex;
      padding: 10px;
      background-color: white;
      border-top: 1px solid #eee;
      gap: 5px;
      align-items: center;
    }
    
    .message-input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 3px;
      font-size: 14px;
    }
    
    .emoji-btn {
      background: #ffc107;
      color: white;
      border: none;
      padding: 8px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .send-btn {
      background-color: #2F5C73;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .logout-btn {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .admin-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
      display: none;
    }
    
    /* تذييل الصفحة */
    .footer {
      background-color: white;
      padding: 5px 10px;
      text-align: center;
      font-size: 12px;
      color: #666;
      border-top: 1px solid #eee;
    }
    
    /* لوحة الإيموجي */
    .emoji-panel {
      display: none;
      position: absolute;
      bottom: 60px;
      left: 10px;
      right: 10px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .emoji-categories {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    
    .emoji-category {
      padding: 5px 10px;
      border: none;
      background: #f5f5f5;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .emoji-category.active {
      background: #2F5C73;
      color: white;
    }
    
    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 5px;
    }
    
    .emoji {
      font-size: 18px;
      cursor: pointer;
      text-align: center;
      padding: 5px;
      border-radius: 3px;
    }
    
    .emoji:hover {
      background: #f0f0f0;
    }
    
    /* لوحة التحكم */
    .admin-panel {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }
    
    .admin-content {
      background: white;
      border-radius: 10px;
      padding: 20px;
      max-width: 100%;
      margin: 0 auto;
    }
    
    .admin-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #2F5C73;
    }
    
    .admin-title {
      font-size: 18px;
      font-weight: bold;
      color: #2F5C73;
    }
    
    .close-admin {
      background: #dc3545;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
    }
    
    .admin-section {
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 5px;
      border: 1px solid #dee2e6;
    }
    
    .admin-section h3 {
      margin-bottom: 10px;
      color: #2F5C73;
      font-size: 16px;
    }
    
    .admin-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .admin-btn-small {
      background: #2F5C73;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .admin-btn-danger {
      background: #dc3545;
    }
    
    .user-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 5px;
    }
    
    .user-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    
    .user-list-item:last-child {
      border-bottom: none;
    }
    
    .user-actions {
      display: flex;
      gap: 5px;
    }
    
    /* بروفايل المستخدم */
    .profile-panel {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }
    
    .profile-content {
      background: white;
      border-radius: 10px;
      padding: 20px;
      max-width: 100%;
      margin: 0 auto;
    }
    
    .profile-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #2F5C73;
    }
    
    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      background: #2F5C73;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 32px;
      font-weight: bold;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      position: relative;
    }
    
    .change-avatar-btn {
      position: absolute;
      bottom: -5px;
      right: -5px;
      background: #2F5C73;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      font-size: 12px;
      cursor: pointer;
    }
    
    .profile-info {
      flex: 1;
    }
    
    .profile-name {
      font-size: 18px;
      font-weight: bold;
      color: #2F5C73;
      margin-bottom: 5px;
    }
    
    .profile-role {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }
    
    .profile-stats {
      display: flex;
      gap: 15px;
      font-size: 12px;
      color: #888;
    }
    
    .profile-section {
      margin-bottom: 20px;
    }
    
    .profile-section h3 {
      margin-bottom: 10px;
      color: #2F5C73;
      font-size: 16px;
    }
    
    .profile-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .profile-btn {
      background: #2F5C73;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .profile-btn.danger {
      background: #dc3545;
    }
    
    .profile-btn.success {
      background: #28a745;
    }
    
    .admin-actions {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      border: 1px solid #dee2e6;
    }
    
    /* تحسينات للجوال */
    @media (max-width: 480px) {
      body {
        padding: 5px;
      }
      
      .main-wrapper {
        max-height: 100%;
        border-radius: 0;
      }
      
      .user-avatar {
        width: 35px;
        height: 35px;
        font-size: 14px;
      }
      
      .admin-controls {
        grid-template-columns: 1fr;
      }
      
      .input-area {
        flex-wrap: wrap;
      }
      
      .message-input {
        margin-bottom: 5px;
      }
      
      .microphones-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .emoji-grid {
        grid-template-columns: repeat(6, 1fr);
      }
      
      .profile-actions {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head> 

<body>
  <!-- الحاوية الرئيسية -->
  <div class="main-wrapper">
    <!-- شاشة الدخول -->
    <div id="loginScreen">
      <!-- الهيدر -->
      <div class="header">
        <div class="header-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
          </svg>
        </div>
        <div class="header-title">دردشه جوال هوست | شات جوال هوست</div>
        <div class="header-icon" onclick="location.reload()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="white">
            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
          </svg>
        </div>
      </div>
      
      <!-- البنر تحت الهيدر -->
      <div class="banner">
        شات جوال هوست - أفضل منصة دردشة عربية
      </div>
      
      <!-- التبويبات -->
      <div class="tabs">
        <div class="tab active" onclick="switchTab(1)">دخول الزوار</div>
        <div class="tab" onclick="switchTab(2)">دخول الأعضاء</div>
        <div class="tab" onclick="switchTab(3)">تسجيل عضوية</div>
      </div>
      
      <!-- نماذج الدخول -->
      <div class="login-forms">
        <!-- دخول الزوار -->
        <div class="login-form active" id="form1">
          <input type="text" class="form-input" id="guestName" placeholder="أكتب الاسم المستعار">
          <button class="form-btn" onclick="login(1)">دخول</button>
        </div>
        
        <!-- دخول الأعضاء -->
        <div class="login-form" id="form2">
          <input type="text" class="form-input" id="memberName" placeholder="اكتب اسم العضو">
          <input type="password" class="form-input" id="memberPassword" placeholder="اكتب كلمة المرور">
          <button class="form-btn" onclick="login(2)">دخول</button>
        </div>
        
        <!-- تسجيل عضوية -->
        <div class="login-form" id="form3">
          <input type="text" class="form-input" id="newName" placeholder="اكتب اسم العضو">
          <input type="password" class="form-input" id="newPassword" placeholder="اكتب كلمة المرور">
          <button class="form-btn" onclick="login(3)">تسجيل</button>
        </div>
      </div>
      
      <!-- شريط الحالة -->
      <div class="status-bar">
        <span id="loginStatus">جاري الاتصال...</span>
        <span id="onlineCount">0 متواجد</span>
      </div>
      
      <!-- قائمة المتواجدين -->
      <div class="online-users" id="onlineUsers">
        <div class="no-users">لا يوجد متواجدين حالياً</div>
      </div>
      
      <!-- التذييل - سيتم إخفاؤه بعد الدخول -->
      <div class="footer" id="copyrightFooter">
        Copyright © 2021-2023 <a href="https://jawalhost.com/" style="color: #2F5C73;">جوال هوست</a>. All Rights Reserved
      </div>
    </div>
    
    <!-- شاشة المحادثة -->
    <div class="chat-area" id="chatScreen">
      <!-- لوحة المايكروفونات -->
      <div class="microphones-panel">
        <div class="microphones-header">
          <div class="microphones-title">المايكروفونات النشطة</div>
          <button class="mute-all-btn" onclick="toggleMuteAll()">كتم الكل</button>
        </div>
        <div class="microphones-grid" id="microphonesGrid">
          <!-- المايكروفونات ستضاف هنا ديناميكياً -->
        </div>
      </div>
      
      <!-- منطقة الرسائل -->
      <div class="messages-container" id="messagesContainer">
        <!-- سيتم إضافة الرسائل هنا -->
      </div>
      
      <!-- لوحة الإيموجي -->
      <div class="emoji-panel" id="emojiPanel">
        <div class="emoji-categories">
          <button class="emoji-category active" onclick="switchEmojiCategory('faces')">وجوه</button>
          <button class="emoji-category" onclick="switchEmojiCategory('hearts')">قلوب</button>
          <button class="emoji-category" onclick="switchEmojiCategory('objects')">أشياء</button>
          <button class="emoji-category" onclick="switchEmojiCategory('symbols')">رموز</button>
        </div>
        <div class="emoji-grid" id="emojiGrid">
          <!-- الإيموجي سيضاف هنا ديناميكياً -->
        </div>
      </div>
      
      <!-- منطقة الإدخال -->
      <div class="input-area">
        <input type="text" class="message-input" id="messageInput" placeholder="اكتب رسالتك هنا...">
        <button class="emoji-btn" onclick="toggleEmojiPanel()">😊</button>
        <button class="admin-btn" id="adminPanelBtn" onclick="openAdminPanel()">لوحة التحكم</button>
        <button class="logout-btn" onclick="logout()">خروج</button>
        <button class="send-btn" onclick="sendMessage()">إرسال</button>
      </div>
    </div>
    
    <!-- لوحة التحكم -->
    <div class="admin-panel" id="adminPanel">
      <div class="admin-content">
        <div class="admin-header">
          <div class="admin-title">لوحة تحكم المشرف</div>
          <button class="close-admin" onclick="closeAdminPanel()">إغلاق</button>
        </div>
        
        <div class="admin-section">
          <h3>إدارة الإيموجي</h3>
          <div class="admin-controls">
            <button class="admin-btn-small" onclick="addCustomEmoji()">إضافة إيموجي مخصص</button>
            <button class="admin-btn-small" onclick="manageEmojiCategories()">إدارة فئات الإيموجي</button>
            <button class="admin-btn-small admin-btn-danger" onclick="resetEmojiSettings()">إعادة تعيين الإيموجي</button>
          </div>
        </div>
        
        <div class="admin-section">
          <h3>إدارة المايكروفونات</h3>
          <div class="admin-controls">
            <button class="admin-btn-small" onclick="resetAllMicrophones()">إعادة تعيين المايكات</button>
            <button class="admin-btn-small" onclick="shuffleMicrophones()">تبديل المايكات</button>
            <button class="admin-btn-small admin-btn-danger" onclick="kickAllFromMicrophones()">طرد الجميع من المايكات</button>
          </div>
        </div>
        
        <div class="admin-section">
          <h3>إدارة المستخدمين</h3>
          <div class="admin-controls">
            <button class="admin-btn-small" onclick="kickUser()">طرد مستخدم</button>
            <button class="admin-btn-small" onclick="banUser()">حظر مستخدم</button>
            <button class="admin-btn-small" onclick="muteUser()">كتم مستخدم</button>
            <button class="admin-btn-small admin-btn-danger" onclick="clearChat()">مسح المحادثة</button>
          </div>
          <div class="user-list" id="userList">
            <!-- قائمة المستخدمين ستظهر هنا -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- بروفايل المستخدم -->
    <div class="profile-panel" id="profilePanel">
      <div class="profile-content">
        <div class="profile-header">
          <div class="profile-avatar" id="profileAvatar" onclick="changeAvatar()">
            <button class="change-avatar-btn">+</button>
          </div>
          <div class="profile-info">
            <div class="profile-name" id="profileName">اسم المستخدم</div>
            <div class="profile-role" id="profileRole">مستخدم عادي</div>
            <div class="profile-stats">
              <span>النقاط: <span id="profilePoints">0</span></span>
              <span>المستوى: <span id="profileLevel">1</span></span>
              <span>التقييم: <span id="profileRating">⭐</span></span>
            </div>
          </div>
        </div>
        
        <div class="profile-section">
          <h3>الإجراءات</h3>
          <div class="profile-actions">
            <button class="profile-btn" onclick="sendPrivateMessage()">رسالة خاصة</button>
            <button class="profile-btn" onclick="viewProfileHistory()">سجل النشاط</button>
          </div>
        </div>
        
        <div class="profile-section" id="adminProfileSection" style="display: none;">
          <h3>أدوات المشرف</h3>
          <div class="admin-actions">
            <div class="profile-actions">
              <button class="profile-btn danger" onclick="adminKickUser()">طرد المستخدم</button>
              <button class="profile-btn danger" onclick="adminBanUser()">حظر المستخدم</button>
              <button class="profile-btn" onclick="adminMuteUser()">كتم الصوت</button>
              <button class="profile-btn" onclick="adminViewIP()">كشف IP</button>
              <button class="profile-btn success" onclick="adminPromoteUser()">ترقية المستخدم</button>
              <button class="profile-btn danger" onclick="adminRemoveAvatar()">إزالة الصورة</button>
            </div>
          </div>
        </div>
        
        <div class="profile-section">
          <button class="profile-btn" onclick="closeProfile()" style="background: #6c757d; width: 100%;">إغلاق</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // بيانات التطبيق
    let currentUser = '';
    let currentTab = 1;
    let userRole = 'user'; // user, admin, moderator
    let socket = null;
    const adminUsers = ['admin', 'administrator', 'مشرف', 'ادمن', 'مدير'];
    const moderatorUsers = ['moderator', 'مشرف', 'مراقب', 'mod'];
    let currentProfileUser = null;
    
    // بيانات المايكروفونات
    let microphones = [
      { id: 1, user: null, active: false, muted: false, talking: false },
      { id: 2, user: null, active: false, muted: false, talking: false },
      { id: 3, user: null, active: false, muted: false, talking: false },
      { id: 4, user: null, active: false, muted: false, talking: false },
      { id: 5, user: null, active: false, muted: false, talking: false }
    ];
    
    let isMuteAll = false;

    // بيانات الإيموجي
    const emojis = {
      faces: ['😀', '😃', '😄', '😁', '😆', '😅', '😂', '🤣', '😊', '😇', '🙂', '🙃', '😉', '😌', '😍', '🥰', '😘', '😗', '😙', '😚', '😋', '😛', '😝', '😜', '🤪', '🤨', '🧐', '🤓', '😎', '🤩', '🥳', '😏', '😒', '😞', '😔', '😟', '😕', '🙁', '☹️', '😣', '😖', '😫', '😩', '🥺', '😢', '😭', '😤', '😠', '😡', '🤬', '🤯', '😳', '🥵', '🥶', '😱', '😨', '😰', '😥', '😓', '🤗', '🤔', '🤭', '🤫', '🤥', '😶', '😐', '😑', '😬', '🙄', '😯', '😦', '😧', '😮', '😲', '🥱', '😴', '🤤', '😪', '😵', '🤐', '🥴', '🤢', '🤮', '🤧', '😷', '🤒', '🤕'],
      hearts: ['❤️', '🧡', '💛', '💚', '💙', '💜', '🖤', '🤍', '🤎', '💔', '❣️', '💕', '💞', '💓', '💗', '💖', '💘', '💝', '💟'],
      objects: ['⌚', '📱', '📲', '💻', '⌨️', '🖥️', '🖨️', '🖱️', '🖲️', '🕹️', '🗜️', '💽', '💾', '💿', '📀', '📼', '📷', '📸', '📹', '🎥', '📽️', '🎞️', '📞', '☎️', '📟', '📠', '📺', '📻', '🎙️', '🎚️', '🎛️', '🧭', '⏱️', '⏲️', '⏰', '🕰️', '⌛', '⏳', '📡', '🔋', '🔌', '💡', '🔦', '🕯️', '🪔', '🧯', '🛢️', '💸', '💵', '💴', '💶', '💷', '💰', '💳', '💎', '⚖️', '🧰', '🔧', '🔨', '⚒️', '🛠️', '⛏️', '🔩', '⚙️', '🧱', '⛓️', '🧲', '🔫', '💣', '🧨', '🪓', '🔪', '🗡️', '⚔️', '🛡️', '🚬', '⚰️', '⚱️', '🏺', '🔮', '📿', '🧿', '💈', '⚗️', '🔭', '🔬', '🕳️', '🩹', '🩺', '💊', '💉', '🩸', '🧬', '🦠', '🧫', '🧪', '🌡️', '🧹', '🧺', '🧻', '🚽', '🚰', '🚿', '🛁', '🛀', '🧼', '🪒', '🧽', '🧴', '🛎️', '🔑', '🗝️', '🚪', '🪑', '🛋️', '🛏️', '🛌', '🧸', '🖼️', '🛍️', '🛒', '🎁', '🎈', '🎏', '🎀', '🎊', '🎉', '🎎', '🏮', '🎐', '✉️', '📩', '📨', '📧', '💌', '📥', '📤', '📦', '🏷️', '📪', '📫', '📬', '📭', '📮', '📯', '📜', '📃', '📄', '📑', '🧾', '📊', '📈', '📉', '🗒️', '🗓️', '📆', '📅', '🗑️', '📇', '🗃️', '🗳️', '🗄️', '📋', '📁', '📂', '🗂️', '🗞️', '📰', '📓', '📔', '📒', '📕', '📗', '📘', '📙', '📚', '📖', '🔖', '🧷', '🔗', '📎', '🖇️', '📐', '📏', '🧮', '📌', '📍', '✂️', '🖊️', '🖋️', '✒️', '🖌️', '🖍️', '📝', '✏️', '🔍', '🔎', '🔏', '🔐', '🔒', '🔓'],
      symbols: ['❤️', '💛', '💚', '💙', '💜', '🖤', '🤍', '🤎', '💔', '❣️', '💕', '💞', '💓', '💗', '💖', '💘', '💝', '💟', '☮️', '✝️', '☪️', '🕉️', '☸️', '✡️', '🔯', '🕎', '☯️', '☦️', '🛐', '⛎', '♈', '♉', '♊', '♋', '♌', '♍', '♎', '♏', '♐', '♑', '♒', '♓', '🆔', '⚛️', '🉑', '☢️', '☣️', '📴', '📳', '🈶', '🈚', '🈸', '🈺', '🈷️', '✴️', '🆚', '💮', '🉐', '㊙️', '㊗️', '🈴', '🈵', '🈹', '🈲', '🅰️', '🅱️', '🆎', '🆑', '🅾️', '🆘', '❌', '⭕', '🛑', '⛔', '📛', '🚫', '💯', '💢', '♨️', '🚷', '🚯', '🚳', '🚱', '🔞', '📵', '🚭', '❗', '❕', '❓', '❔', '‼️', '⁉️', '🔅', '🔆', '〽️', '⚠️', '🚸', '🔱', '⚜️', '🔰', '♻️', '✅', '🈯', '💹', '❇️', '✳️', '❎', '🌐', '💠', 'Ⓜ️', '🌀', '💤', '🏧', '🚾', '♿', '🅿️', '🈳', '🈂️', '🛂', '🛃', '🛄', '🛅', '🚹', '🚺', '🚼', '🚻', '🚮', '🎦', '📶', '🈁', '🔣', 'ℹ️', '🔤', '🔡', '🔠', '🆖', '🆗', '🆙', '🆒', '🆕', '🆓', '0️⃣', '1️⃣', '2️⃣', '3️⃣', '4️⃣', '5️⃣', '6️⃣', '7️⃣', '8️⃣', '9️⃣', '🔟', '🔢', '#️⃣', '*️⃣', '⏏️', '▶️', '⏸️', '⏯️', '⏹️', '⏺️', '⏭️', '⏮️', '⏩', '⏪', '⏫', '⏬', '◀️', '🔼', '🔽', '➡️', '⬅️', '⬆️', '⬇️', '↗️', '↘️', '↙️', '↖️', '↕️', '↔️', '↪️', '↩️', '⤴️', '⤵️', '🔀', '🔁', '🔂', '🔄', '🔃', '🎵', '🎶', '➕', '➖', '➗', '✖️', '♾️', '💲', '💱', '™️', '©️', '®️', '〰️', '➰', '➿', '🔚', '🔙', '🔛', '🔝', '🔜', '✔️', '☑️', '🔘', '🔴', '🟠', '🟡', '🟢', '🔵', '🟣', '⚫', '⚪', '🟤', '🔺', '🔻', '🔸', '🔹', '🔶', '🔷', '🔳', '🔲', '▪️', '▫️', '◾', '◽', '◼️', '◻️', '🟥', '🟧', '🟨', '🟩', '🟦', '🟪', '⬛', '⬜', '🟫', '🔈', '🔇', '🔉', '🔊', '🔔', '🔕', '📣', '📢', '👁️‍🗨️', '💬', '💭', '🗯️', '♠️', '♣️', '♥️', '♦️', '🃏', '🎴', '🀄', '🕐', '🕑', '🕒', '🕓', '🕔', '🕕', '🕖', '🕗', '🕘', '🕙', '🕚', '🕛', '🕜', '🕝', '🕞', '🕟', '🕠', '🕡', '🕢', '🕣', '🕤', '🕥', '🕦', '🕧']
    };

    // تهيئة التطبيق
    document.addEventListener('DOMContentLoaded', function() {
      // الاتصال بالخادم
      socket = io();
      
      // تحديث حالة الاتصال
      document.getElementById('loginStatus').textContent = 'متصل';
      
      // إعداد مستمعي الأحداث
      setupSocketListeners();
      
      // إضافة حدث Enter لإرسال الرسالة
      document.getElementById('messageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      // تحميل المايكروفونات
      renderMicrophones();
      
      // تحميل الإيموجي
      loadEmojis('faces');
    });
    
    // إعداد مستمعي أحداث السوكيت
    function setupSocketListeners() {
      // تحديث قائمة المستخدمين
      socket.on('update-users', (users) => {
        updateOnlineUsers(users);
      });
      
      // تحديث عدد المستخدمين
      socket.on('user-count', (count) => {
        document.getElementById('onlineCount').textContent = `${count} متواجد`;
      });
      
      // استقبال رسالة جديدة
      socket.on('new-message', (messageData) => {
        addMessageToChat(messageData);
      });
      
      // استقبال البيانات الحالية
      socket.on('current-data', (data) => {
        updateOnlineUsers(data.users);
        document.getElementById('onlineCount').textContent = `${data.users.length} متواجد`;
        
        // تحميل الرسائل السابقة
        data.messages.forEach(message => {
          addMessageToChat(message);
        });
      });
      
      // اسم المستخدم مستخدم بالفعل
      socket.on('username-taken', (message) => {
        alert(message);
        document.getElementById('loginScreen').style.display = 'block';
        document.getElementById('chatScreen').style.display = 'none';
      });
      
      // تم طرد المستخدم
      socket.on('kicked', (reason) => {
        alert(`تم طردك من الدردشة: ${reason}`);
        logout();
      });
      
      // تم حذف رسالة
      socket.on('message-deleted', (messageId) => {
        const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
        if (messageElement) {
          messageElement.remove();
        }
      });
      
      // تم مسح المحادثة
      socket.on('chat-cleared', (data) => {
        document.getElementById('messagesContainer').innerHTML = '';
        addSystemMessage(`تم مسح جميع الرسائل بواسطة ${data.by}`);
      });
      
      // تم طرد مستخدم
      socket.on('user-kicked', (data) => {
        addSystemMessage(`تم طرد ${data.username} بواسطة ${data.by}: ${data.reason}`);
      });
    }
    
    // تبديل تبويبات الدخول
    function switchTab(tabNumber) {
      currentTab = tabNumber;
      
      // تحديث التبويبات النشطة
      document.querySelectorAll('.tab').forEach((tab, index) => {
        if (index + 1 === tabNumber) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // تحديث النماذج النشطة
      document.querySelectorAll('.login-form').forEach((form, index) => {
        if (index + 1 === tabNumber) {
          form.classList.add('active');
        } else {
          form.classList.remove('active');
        }
      });
    }
    
    // تسجيل الدخول
    function login(type) {
      let username = '';
      
      if (type === 1) {
        username = document.getElementById('guestName').value.trim();
      } else if (type === 2) {
        username = document.getElementById('memberName').value.trim();
      } else if (type === 3) {
        username = document.getElementById('newName').value.trim();
      }
      
      if (!username) {
        alert('يرجى إدخال اسم المستخدم');
        return;
      }
      
      currentUser = username;
      setUserRole(username);
      
      // إرسال بيانات المستخدم للخادم
      socket.emit('user-joined', {
        username: username,
        role: userRole
      });
      
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('chatScreen').style.display = 'flex';
      document.getElementById('copyrightFooter').style.display = 'none';
      toggleAdminButton();
    }
    
    // تحديد صلاحية المستخدم
    function setUserRole(username) {
      const lowerUsername = username.toLowerCase();
      
      if (adminUsers.some(admin => lowerUsername.includes(admin.toLowerCase()))) {
        userRole = 'admin';
      } else if (moderatorUsers.some(mod => lowerUsername.includes(mod.toLowerCase()))) {
        userRole = 'moderator';
      } else {
        userRole = 'user';
      }
    }
    
    // إظهار أو إخفاء زر لوحة التحكم
    function toggleAdminButton() {
      const adminBtn = document.getElementById('adminPanelBtn');
      if (userRole === 'admin' || userRole === 'moderator') {
        adminBtn.style.display = 'block';
      } else {
        adminBtn.style.display = 'none';
      }
    }
    
    // إرسال رسالة
    function sendMessage() {
      const messageInput = document.getElementById('messageInput');
      const message = messageInput.value.trim();
      
      if (!message) {
        alert('يرجى كتابة رسالة');
        return;
      }
      
      const messageData = {
        username: currentUser,
        message: message,
        role: userRole
      };
      
      // إرسال الرسالة للخادم
      socket.emit('new-message', messageData);
      
      messageInput.value = '';
      closeEmojiPanel();
    }
    
    // إضافة رسالة للشات
    function addMessageToChat(messageData) {
      const messagesContainer = document.getElementById('messagesContainer');
      
      const isSystemMessage = messageData.type === 'system';
      const isAdminMessage = messageData.role === 'admin' || messageData.role === 'moderator';
      
      if (isSystemMessage) {
        // رسالة نظام
        const systemMsg = document.createElement('div');
        systemMsg.className = 'message system-message';
        systemMsg.setAttribute('data-message-id', messageData.id);
        systemMsg.innerHTML = `
          <div class="message-content">
            <div class="message-text">${messageData.message}</div>
            <div class="message-time">${messageData.time}</div>
          </div>
        `;
        messagesContainer.appendChild(systemMsg);
      } else {
        // رسالة مستخدم عادي
        const senderClass = isAdminMessage ? 'admin-sender' : '';
        const adminBadge = isAdminMessage ? '<div class="admin-badge">A</div>' : '';
        const deleteButton = (userRole === 'admin' || userRole === 'moderator') ? 
          '<button class="delete-message-btn" onclick="deleteMessage(' + messageData.id + ')">×</button>' : '';
        
        const userMessage = document.createElement('div');
        userMessage.className = 'message';
        userMessage.setAttribute('data-message-id', messageData.id);
        userMessage.innerHTML = `
          <div class="user-avatar" onclick="openProfile('${messageData.username}')" style="background-color: ${getRandomColor()}">
            ${messageData.username.charAt(0)}
            ${adminBadge}
          </div>
          <div class="message-content">
            ${deleteButton}
            <div class="message-header">
              <div class="message-sender ${senderClass}" onclick="openProfile('${messageData.username}')">${messageData.username}</div>
              <div class="message-time">${messageData.time}</div>
            </div>
            <div class="message-text">${messageData.message}</div>
          </div>
        `;
        
        messagesContainer.appendChild(userMessage);
      }
      
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // إضافة رسالة نظام
    function addSystemMessage(message) {
      const messagesContainer = document.getElementById('messagesContainer');
      
      const systemMsg = document.createElement('div');
      systemMsg.className = 'message system-message';
      systemMsg.innerHTML = `
        <div class="message-content">
          <div class="message-text">${message}</div>
          <div class="message-time">${new Date().toLocaleTimeString('ar-EG')}</div>
        </div>
      `;
      
      messagesContainer.appendChild(systemMsg);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // حذف رسالة
    function deleteMessage(messageId) {
      if (userRole === 'admin' || userRole === 'moderator') {
        socket.emit('delete-message', messageId);
      } else {
        alert('ليس لديك صلاحية حذف الرسائل');
      }
    }
    
    // تحديث قائمة المتواجدين
    function updateOnlineUsers(users) {
      const onlineUsersContainer = document.getElementById('onlineUsers');
      
      // مسح المحتوى الحالي
      onlineUsersContainer.innerHTML = '';
      
      if (users.length === 0) {
        const noUsersMsg = document.createElement('div');
        noUsersMsg.className = 'no-users';
        noUsersMsg.textContent = 'لا يوجد متواجدين حالياً';
        onlineUsersContainer.appendChild(noUsersMsg);
      } else {
        users.forEach(user => {
          const userItem = document.createElement('div');
          userItem.className = 'user-item';
          userItem.innerHTML = `
            <div class="user-avatar" onclick="openProfile('${user.username}')" style="background-color: ${user.avatar}">
              ${user.username.charAt(0)}
            </div>
            <span>${user.username}</span>
            ${user.role !== 'user' ? '<span style="color: #dc3545; font-size: 12px;">(مشرف)</span>' : ''}
          `;
          onlineUsersContainer.appendChild(userItem);
        });
      }
    }
    
    // ===== نظام الإيموجي =====
    
    // تحميل الإيموجي
    function loadEmojis(category) {
      const emojiGrid = document.getElementById('emojiGrid');
      emojiGrid.innerHTML = '';
      
      // تحديث التبويبات النشطة
      document.querySelectorAll('.emoji-category').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // إضافة الإيموجي
      emojis[category].forEach(emoji => {
        const emojiElement = document.createElement('div');
        emojiElement.className = 'emoji';
        emojiElement.textContent = emoji;
        emojiElement.onclick = () => insertEmoji(emoji);
        emojiGrid.appendChild(emojiElement);
      });
    }
    
    // تبديل فئة الإيموجي
    function switchEmojiCategory(category) {
      loadEmojis(category);
    }
    
    // إدراج الإيموجي في الرسالة
    function insertEmoji(emoji) {
      const messageInput = document.getElementById('messageInput');
      messageInput.value += emoji;
      messageInput.focus();
    }
    
    // فتح/إغلاق لوحة الإيموجي
    function toggleEmojiPanel() {
      const emojiPanel = document.getElementById('emojiPanel');
      if (emojiPanel.style.display === 'block') {
        closeEmojiPanel();
      } else {
        emojiPanel.style.display = 'block';
      }
    }
    
    function closeEmojiPanel() {
      document.getElementById('emojiPanel').style.display = 'none';
    }
    
    // ===== نظام المايكروفونات =====
    
    // عرض المايكروفونات
    function renderMicrophones() {
      const grid = document.getElementById('microphonesGrid');
      grid.innerHTML = '';
      
      microphones.forEach(mic => {
        const micElement = document.createElement('div');
        micElement.className = `microphone-slot ${mic.active ? 'active' : ''} ${mic.muted ? 'muted' : ''}`;
        micElement.innerHTML = `
          <div class="microphone-user">${mic.user || 'فارغ'}</div>
          <div class="microphone-controls">
            ${mic.user ? `
              <button class="mic-btn mic-toggle" onclick="toggleMicrophone(${mic.id})">
                ${mic.active ? '🔊' : '🔈'}
              </button>
              <button class="mic-btn mic-mute" onclick="toggleMuteMicrophone(${mic.id})">
                ${mic.muted ? '🔇' : '🔊'}
              </button>
              ${userRole === 'admin' || userRole === 'moderator' ? `
                <button class="mic-btn mic-kick" onclick="kickFromMicrophone(${mic.id})">🚫</button>
              ` : ''}
            ` : `
              <button class="mic-btn mic-toggle" onclick="takeMicrophone(${mic.id})">🎤</button>
            `}
          </div>
          <div class="mic-status ${mic.talking ? 'mic-talking' : ''}">
            ${mic.talking ? 'يتحدث...' : (mic.muted ? 'مكتوم' : (mic.active ? 'نشط' : 'غير نشط'))}
          </div>
        `;
        grid.appendChild(micElement);
      });
    }
    
    // احتلال مايكروفون
    function takeMicrophone(micId) {
      const mic = microphones.find(m => m.id === micId);
      if (mic && !mic.user) {
        mic.user = currentUser;
        mic.active = true;
        renderMicrophones();
      }
    }
    
    // تبديل حالة المايكروفون
    function toggleMicrophone(micId) {
      const mic = microphones.find(m => m.id === micId);
      if (mic && mic.user === currentUser) {
        mic.active = !mic.active;
        if (mic.active) {
          mic.talking = true;
          // محاكاة التحدث
          setTimeout(() => {
            mic.talking = false;
            renderMicrophones();
          }, 3000);
        }
        renderMicrophones();
      }
    }
    
    // كتم/إلغاء كتم المايكروفون
    function toggleMuteMicrophone(micId) {
      const mic = microphones.find(m => m.id === micId);
      if (mic && (mic.user === currentUser || userRole === 'admin' || userRole === 'moderator')) {
        mic.muted = !mic.muted;
        renderMicrophones();
      }
    }
    
    // طرد مستخدم من المايكروفون (للمشرفين فقط)
    function kickFromMicrophone(micId) {
      if (userRole === 'admin' || userRole === 'moderator') {
        const mic = microphones.find(m => m.id === micId);
        if (mic && mic.user) {
          const kickedUser = mic.user;
          mic.user = null;
          mic.active = false;
          mic.muted = false;
          mic.talking = false;
          renderMicrophones();
          addSystemMessage(`تم طرد ${kickedUser} من المايكروفون`);
        }
      }
    }
    
    // كتم/إلغاء كتم جميع المايكروفونات
    function toggleMuteAll() {
      isMuteAll = !isMuteAll;
      microphones.forEach(mic => {
        if (mic.user) {
          mic.muted = isMuteAll;
        }
      });
      renderMicrophones();
    }
    
    // ===== نظام البروفايل =====
    
    // فتح بروفايل المستخدم
    function openProfile(username) {
      currentProfileUser = username;
      const profilePanel = document.getElementById('profilePanel');
      const profileName = document.getElementById('profileName');
      const profileRole = document.getElementById('profileRole');
      const profileAvatar = document.getElementById('profileAvatar');
      const adminSection = document.getElementById('adminProfileSection');
      
      // تعيين بيانات البروفايل
      profileName.textContent = username;
      
      // تحديد دور المستخدم
      let roleText = 'مستخدم عادي';
      let roleColor = '#2F5C73';
      
      if (adminUsers.some(admin => username.toLowerCase().includes(admin.toLowerCase()))) {
        roleText = 'مدير النظام';
        roleColor = '#dc3545';
      } else if (moderatorUsers.some(mod => username.toLowerCase().includes(mod.toLowerCase()))) {
        roleText = 'مشرف';
        roleColor = '#28a745';
      }
      
      profileRole.textContent = roleText;
      profileRole.style.color = roleColor;
      
      // تعيين الصورة الرمزية
      profileAvatar.textContent = username.charAt(0);
      profileAvatar.style.backgroundColor = getRandomColor();
      
      // إظهار/إخفاء أدوات المشرف
      if (userRole === 'admin' || userRole === 'moderator') {
        adminSection.style.display = 'block';
      } else {
        adminSection.style.display = 'none';
      }
      
      profilePanel.style.display = 'block';
    }
    
    // إغلاق البروفايل
    function closeProfile() {
      document.getElementById('profilePanel').style.display = 'none';
      currentProfileUser = null;
    }
    
    // ===== أدوات المشرف في البروفايل =====
    
    // طرد المستخدم (للمشرفين)
    function adminKickUser() {
      if (confirm(`هل تريد طرد ${currentProfileUser}؟`)) {
        socket.emit('kick-user', {
          username: currentProfileUser,
          by: currentUser,
          reason: 'بأمر المشرف'
        });
        closeProfile();
      }
    }
    
    // حظر المستخدم (للمشرفين)
    function adminBanUser() {
      if (confirm(`هل تريد حظر ${currentProfileUser} بشكل دائم؟`)) {
        addSystemMessage(`تم حظر ${currentProfileUser} بشكل دائم`);
        closeProfile();
      }
    }
    
    // ===== أدوات المشرف في لوحة التحكم =====
    
    function resetAllMicrophones() {
      microphones.forEach(mic => {
        mic.user = null;
        mic.active = false;
        mic.muted = false;
        mic.talking = false;
      });
      renderMicrophones();
    }
    
    function clearChat() {
      if (confirm('هل أنت متأكد من رغبتك في مسح جميع الرسائل؟')) {
        socket.emit('clear-chat', { by: currentUser });
      }
    }
    
    function kickUser() {
      const username = prompt('أدخل اسم المستخدم الذي تريد طرده:');
      if (username) {
        socket.emit('kick-user', {
          username: username,
          by: currentUser,
          reason: 'بأمر المشرف'
        });
      }
    }
    
    // ===== دوال مساعدة =====
    
    // توليد لون عشوائي
    function getRandomColor() {
      const colors = ['#2F5C73', '#28a745', '#dc3545', '#ffc107', '#6f42c1', '#e83e8c', '#fd7e14'];
      return colors[Math.floor(Math.random() * colors.length)];
    }
    
    // ===== باقي الدوال =====
    
    // تسجيل الخروج
    function logout() {
      // تحرير المايكروفونات التي يشغلها المستخدم
      microphones.forEach(mic => {
        if (mic.user === currentUser) {
          mic.user = null;
          mic.active = false;
          mic.muted = false;
          mic.talking = false;
        }
      });
      
      // قطع الاتصال بالسوكيت
      if (socket) {
        socket.disconnect();
      }
      
      // إعادة التحميل للعودة للاتصال الجديد
      location.reload();
    }
    
    // لوحة التحكم
    function openAdminPanel() {
      if (userRole !== 'admin' && userRole !== 'moderator') {
        alert('ليس لديك صلاحية الوصول إلى لوحة التحكم');
        return;
      }
      document.getElementById('adminPanel').style.display = 'block';
    }
    
    function closeAdminPanel() {
      document.getElementById('adminPanel').style.display = 'none';
    }
    
    // دوال أخرى للوحة التحكم (يمكن تطويرها لاحقاً)
    function banUser() {
      const username = prompt('أدخل اسم المستخدم الذي تريد حظره:');
      if (username) {
        addSystemMessage(`تم حظر ${username} بشكل دائم`);
      }
    }
    
    function muteUser() {
      const username = prompt('أدخل اسم المستخدم الذي تريد كتمه:');
      if (username) {
        addSystemMessage(`تم كتم ${username}`);
      }
    }
    
    function shuffleMicrophones() {
      // يمكن تطوير هذه الوظيفة لاحقاً
      alert('سيتم تطوير هذه الوظيفة في المستقبل');
    }
    
    function kickAllFromMicrophones() {
      microphones.forEach(mic => {
        if (mic.user) {
          mic.user = null;
          mic.active = false;
          mic.muted = false;
          mic.talking = false;
        }
      });
      renderMicrophones();
      addSystemMessage('تم طرد جميع المستخدمين من المايكروفونات');
    }
    
    function addCustomEmoji() {
      const emoji = prompt('أدخل الإيموجي المخصص:');
      if (emoji) {
        emojis.faces.unshift(emoji);
        loadEmojis('faces');
      }
    }
    
    function manageEmojiCategories() {
      alert('إدارة فئات الإيموجي:\n\n- يمكنك إضافة فئات جديدة\n- حذف فئات موجودة\n- تعديل الإيموجي في كل فئة');
    }
    
    function resetEmojiSettings() {
      if (confirm('هل تريد إعادة تعيين إعدادات الإيموجي؟')) {
        location.reload();
      }
    }
  </script>
</body>
</html>